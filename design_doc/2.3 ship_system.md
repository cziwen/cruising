# 2.3 船只系统（Ship System）

## 2.3.1 概述
船只系统管理玩家的船只属性、升级和外观。船只永远显示在屏幕中央，支持简单的动画效果。

## 2.3.2 核心要素

### 船只属性
- **载货量（CargoCapacity）**：决定可携带商品的总重量（单位：kg），基于重量而非数量
- **耐久度（Durability）**：船只的耐久值（简化版，主要用于升级系统）
- **单次攻击伤害（DamagePerShot）**：船只在战斗中每次射击造成的伤害值
- **最大船员数（MaxCrewSize）**：船只可容纳的最大船员数量
- **等级（Level）**：船只等级，影响可解锁的升级选项

### 船只升级（船厂功能）
船只升级采用沉浸式命名，并在下方通过灰色小字描述实际效果：
- **扩建货仓（Expand Cargo Hold）**
  - *描述*：增加最大载货重量
- **加固船体（Reinforce Hull）**
  - *描述*：增加耐久度上限
- **扩建船员舱（Expand Crew Quarters）**
  - *描述*：增加最大船员容纳数量

**升级限制规则**：
- **同步升级**：为了保证船只性能的均衡发展，每个升级选项的等级不能比其他任何选项高出超过 1 级。也就是说，在其他选项达到当前等级之前，不能继续升级该选项。UI 层面，不符合条件的升级按钮将被禁用（变灰）。
- **外观进化**：船只外观（`appearance`）只有在 **所有** 升级选项（货仓、船体、船员）都达到下一个等级时才会进化。外观等级基于三个属性等级的最小值（`minLevel`），对应 `Player_ship_0.png` 到 `Player_ship_6.png`。
- **船只等级 (Ship Level)**：船厂界面会显示船只当前的整体等级（Level），该等级由三个属性升级等级的最小值决定（默认 Lv.0）。

### 船只显示
- **位置**：永远固定在屏幕中央
- **动画**：可选简单动画（如轻微呼吸效果）
- **无物理效果**：不响应任何物理力

## 2.3.3 升级系统

### 升级类型
1. **扩建货仓**
   - **名称**：扩建货仓
   - **描述**：增加最大载货重量
   - **效果**：每次升级增加 100 kg 载货容量
   - **成本**：升级成本按指数级增长（每次升级上涨 20%，计算公式：`基础成本 * 1.2 ^ 当前等级`）

2. **加固船体**
   - **名称**：加固船体
   - **描述**：增加耐久度上限
   - **效果**：每次升级增加 50 点耐久度上限
   - **成本**：升级成本按指数级增长（每次升级上涨 20%）

3. **扩建船员舱**
   - **名称**：扩建船员舱
   - **描述**：增加最大船员容纳数量
   - **效果**：每次升级增加 1 个船员席位
   - **成本**：升级成本按指数级增长（每次升级上涨 20%）

### 升级界面（船厂）
- **标题**：显示升级项目的沉浸式名称（如“扩建货仓”）
- **描述**：在标题下方用灰色小字显示实际效果描述（如“增加最大载货重量”）
- **当前状态**：显示当前属性值
- **升级效果**：显示升级后的属性值预览
- **成本**：显示升级所需金币
- **交互**：点击确认升级后扣除金币并更新属性

## 2.3.4 数据模型

### 船只（Ship）
- `id`: 船只唯一标识
- `name`: 船只名称
- `level`: 当前等级
- `cargoCapacity`: 当前载货重量容量（kg），基于重量而非数量
- `maxCargoCapacity`: 最大载货重量容量（kg，当前等级）
- `durability`: 当前耐久度
- `maxDurability`: 最大耐久度（当前等级）
- `maxCrewMemberCount`: 最大船员容纳数量（新增）
- `damagePerShot`: 单次攻击伤害值（新增）
- `appearance`: 当前外观ID

### 载货量计算方法
- **已使用载货量**：`getUsedCargo(inventory, getGoodsById)` - 计算库存中所有物品的总重量（kg）
  - 需要传入 `getGoodsById` 函数来获取每个商品的重量信息
  - 金币重量为0，不占用载货空间
- **剩余载货量**：`getRemainingCargo(inventory, getGoodsById)` - 返回剩余可载重量（kg）
- **载货空间检查**：`hasEnoughCargo(inventory, additionalWeight, getGoodsById)` - 检查是否有足够空间容纳指定重量
  - `additionalWeight`: 需要添加的重量（kg）
  - 如果重量为0（如金币），直接返回true

### 升级配置（UpgradeConfig）
- `upgradeType`: 升级类型（载货量/耐久度/船员上限/外观）
- `name`: 显示名称（如“扩建货仓”）
- `description`: 效果描述
- `level`: 升级等级
- `cost`: 升级所需金币
- `effect`: 升级效果（增加的数值）
