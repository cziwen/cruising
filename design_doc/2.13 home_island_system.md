# 2.13 主岛系统（Home Island System）

## 2.13.1 概述
主岛系统是玩家的私人领地养成玩法。玩家初始默认停靠在“我的岛屿”（Home Island），通过经营主岛可以获得持续的被动收入（税收），并提供大型仓库用于存储不便随船携带的物资。主岛不仅是玩家的根据地，更是一个可以通过投入金币不断进化的成长实体。

## 2.13.2 核心机制

### 自动税收（Passive Income）
- **产出规则**：游戏时间内每过去 1 小时（`currentHour` 跨越），主岛自动产生一次税收。
- **积累与领取**：
    - 税收不会自动进入玩家账户，而是积累在岛屿上。
    - 当积攒额度 ≥ 1 时，岛屿正上方会出现漂浮的金币按钮。
    - 玩家点击按钮后，积累的税收一次性转入玩家钱包。
- **额度公式**：基础产出为 1 金币/小时，每提升一级“税收额度”，产出增加 1 金币。

### 岛屿仓库（Warehouse）
- **功能**：提供无限（或极大）容量的地面存储空间。
- **入口**：仅能通过“大厅”对话框进入。
- **操作**：玩家在大厅界面的“岛屿仓库”页签中，可以将船上库存存入仓库，或从仓库取回物资。
- **安全性**：仓库中的物资永久保存，且不占据船只载货重量。

### 养成与升级（Upgrades）
主岛提供四个维度的经济升级，通过“大厅”进行管理：
1.  **税收额度**：提升每小时产生的金币数量。
2.  **本地经济**：通过降低岛屿商人的价格敏感度（alpha），使玩家在该岛购买商品时价格更低（最高降低至 0.01）。
3.  **商人资金**：提升本地商人的初始及重置金币额度，方便玩家大批量倾销货物。
4.  **补货速度**：通过增加期望库存（s0） and 缩短补货响应，使商人能够更快、更多地提供货源。

**升级限制规则**：
- **同步升级约束**：为了保证岛屿各方面均衡发展，任何一项升级后的等级都不能超过当前岛屿其他三项功能的最低等级一级以上。
- **示例**：如果当前四项等级分别为 `[Lv.1, Lv.0, Lv.0, Lv.0]`，则已达到 Lv.1 的项在其他三项全部升至 Lv.1 之前，无法继续升级到 Lv.2。
- **最高等级**：所有项目最高可升级至 Lv.7。

## 2.13.3 视觉进化（Visual Evolution）
主岛的视觉表现随养成进度动态变化：
- **等级计算**：岛屿总等级 = `min(税收等级, 经济等级, 资金等级, 补货等级)`。
- **外观变换**：
    - 等级 0-7 分别对应 `assets/images/buildings/village_0.png` 到 `village_7.png`。
    - 只有当所有功能均达到当前等级上限时，岛屿才会跨入下一个视觉阶段。
- **初始状态**：新游戏开始时，岛屿为 0 级，呈现基础村庄样貌。

## 2.13.4 系统流程

### 升级流程
1. 玩家进入“我的岛屿” → 点击“大厅”。
2. 在升级页签查看各项功能当前等级及消耗。
3. 消耗金币点击“升级”。
4. 系统检查是否满足所有项均升级的条件，若满足则触发岛屿视觉进化。

### 仓库转运
1. 玩家在大厅中切换至“仓库”页签。
2. 左侧列表展示船只当前库存及剩余载货量。
3. 右侧展示岛屿仓库库存。
4. 点击箭头或按钮进行双向拨付（取回时需检查船只载重）。

## 2.13.5 数据模型

### HomeIsland (Dart)
- `taxLevel`: 税收等级 (0-7)
- `economyLevel`: 经济等级 (0-7)
- `merchantFundsLevel`: 资金等级 (0-7)
- `restockSpeedLevel`: 补货等级 (0-7)
- `accumulatedTax`: 当前积攒的税收金额
- `warehouseInventory`: 仓库物品列表 (ShipInventoryItem 数组)

## 2.13.6 关联说明
- **导航系统**：主岛 ID 为 `home_island`，默认作为目的地列表的第一项。
- **场景系统**：负责根据 `GameState.homeIsland.level` 切换背景图。
- **贸易系统**：主岛港口的 alpha 和 initialMoney 受养成等级修正。
- **存档系统**：主岛的所有养成进度和仓库物资均会被序列化保存。

