# 1. Overview

## 1.1 Elevator Pitch  
在一个 2D 侧视的单场景中，你扮演一名船长，通过贸易赚取金币，升级船只，以追求更多的财富。游戏采用简化的经营玩法，船永远保持在屏幕中央，通过背景切换来表现不同的港口场景。

## 1.2 核心玩法（Core Gameplay）  
玩家的主要活动围绕以下三大板块展开：  
- **贸易与买卖**：在各大港口低价采购商品，高价售出获利。  
- **船只升级**：使用金币强化船体、提升载货量或装备武器。  
- **港口探索**：访问不同港口，发现新的贸易机会。

## 1.3 核心循环（Core Loop）  
1. 在港口界面，查看当前港口的商品价格
2. 购买低价商品，自动装载到船上（无需手动摆放）
3. 选择下一个目的地港口
4. 背景切换，表示"航行"到新港口
5. 在新港口出售商品，赚取差价
6. 花费金币进行船只和装备升级，提升载货量和航行能力
7. 解锁更多港口，重复循环

## 1.4 游戏架构

### 1.4.1 单场景设计
- 游戏采用单场景设计，所有操作在同一画面完成
- 船永远固定在屏幕中央，不移动
- 通过切换背景层来表现不同的港口场景
- 移除所有物理效果（重力、浮力、波浪等）

### 1.4.2 全局比例与7层渲染系统
- **全局比例锁定**：整个应用程序（MaterialApp）由 `ScaleWrapper` 包裹，强制锁定 16:9 的纵横比。在非 16:9 的屏幕（如网页全屏或长屏手机）上，会自动在两侧或上下填充黑色背景（Black Bars），确保游戏内容不拉伸且布局一致。
- **渲染层级**：游戏画面由7个层级组成（从底到顶）：
  - **背景层（Layer 0）**：远距离背景（天空、远山、云朵等静态元素）
  - **天体层（Layer 0.5）**：太阳/月亮等天体元素（根据昼夜系统动态显示）
  - **近背景层（Layer 1）**：近距离背景（港口建筑、岛屿、海岸线等，可切换）
  - **船层（Layer 2）**：船只，永远居中显示，可添加简单的呼吸动画
  - **屏幕效果层（Layer 2.5）**：全屏视觉效果（如战斗失败时的渐变黑屏）
  - **UI层（Layer 3）**：界面元素（按钮、菜单、信息显示、对话框、交易界面等）
  - **时间显示（Layer 3.5）**：左上角时间显示（独立于其他UI元素）

## 1.5 系统概述
- **贸易系统**：基于交换的交易机制，动态价格系统，增量价格计算，自动装载
- **导航系统**：基于距离（节）的航行计算，航速计算，进度显示，dt增量更新
- **场景系统**：7层渲染系统，背景切换，港口切换动画，天体显示，屏幕效果
- **船只系统**：简化的船只数据模型，支持升级和属性管理，载货量基于重量系统
- **船员系统**：船员管理，职业分配，加成计算，工资结算，技能值曲线生成
- **UI系统**：状态栏显示，对话框系统，按钮布局，时间显示，响应式设计
- **昼夜系统**：时间管理，昼夜循环，季节系统，天体位置计算，dt增量更新
- **战斗系统**：战斗触发，战斗逻辑，战斗结果处理，统一游戏时钟
- **存档系统**：多槽位管理（自动存档+3个手动存档），自动存档，JSON序列化，跨平台存储
- **调试系统**：调试面板，时间倍数调整，跳过航行动画，开发工具
- **港口系统**：港口列表管理，港口选择对话框，距离计算
- **天气系统**：天气状况（平静、小风、风暴），航速修正
- **配置系统**：统一管理货物（`goods.json`）与港口（`ports.json`）的静态数据，支持外部解耦配置

## 1.6 文档结构

### 系统设计文档（2.x系列）
每个系统文档专注于单一领域，保持解耦：

- **2.1 trade_system.md**：贸易系统设计文档
  - 商品价格系统、动态经济、交易界面
  - 参考：港口系统（商品库存）、船只系统（载货量）

- **2.2 navigation_system.md**：导航系统设计文档
  - 距离计算、航速计算、航行进度
  - 参考：场景系统（背景切换）、船员系统（航速加成）

- **2.3 ship_system.md**：船只系统设计文档
  - 船只属性、升级系统、外观管理
  - 参考：贸易系统（载货量限制）

- **2.4 crew_system.md**：船员系统设计文档
  - 船员管理、职业分配、加成计算
  - 参考：导航系统（航速加成）、船只系统（自动修理）

- **2.5 ui_system.md**：UI系统设计文档
  - 界面组件、对话框系统、交互流程
  - 参考：场景系统（6层渲染系统）

- **2.6 scene_system.md**：场景系统设计文档
  - 7层渲染系统、背景切换、港口切换动画、屏幕效果层
  - 参考：导航系统（航行触发）、UI系统（UI层位置）、战斗系统（船只位置）

- **2.7 debug_system.md**：调试系统设计文档
  - 调试面板、调试选项、开发工具
  - 参考：所有系统（调试功能）

- **2.8 day_night_system.md**：昼夜系统设计文档
  - 时间管理、昼夜循环、季节系统、天体位置
  - 参考：场景系统（天体显示）、UI系统（时间显示）、调试系统（时间倍数）

- **2.9 combat_system.md**：战斗系统设计文档
  - 战斗触发、战斗逻辑、战斗结果处理
  - 参考：场景系统（视觉呈现）、船员系统（攻击/修复频率）、导航系统（战斗触发）

- **2.10 main_menu.md**：主菜单设计文档
  - 界面布局、功能按钮、导航流程
  - 参考：存档系统（继续游戏/读取存档）、游戏界面（跳转）

- **2.11 loading_system.md**：加载系统设计文档
  - 场景切换、资源预加载、过渡动画
  - 参考：主菜单（进入游戏）、游戏界面（返回主菜单）

- **2.12 save_system.md**：存档系统设计文档
  - 数据持久化、自动存档、多槽位管理
  - 参考：所有系统（数据序列化）、主菜单（读取入口）

### 文档原则
- **单一职责**：每个文档专注于一个系统领域
- **解耦设计**：通过交叉引用而非重复描述来关联系统
- **清晰边界**：明确每个系统的职责范围

---
文档进度：  
[X] 核心玩法定义  
[X] 核心循环细化  
[X] 主要系统分支（贸易／港口／船只）  
[X] 游戏架构设计  
[X] 当前实现功能总结